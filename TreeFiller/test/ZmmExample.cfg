# $Id: ZmmExample.cfg,v 1.5 2008/07/29 22:54:37 bendavid Exp $

process ZmmTest =
{
    # request 100 events, which is very fast for testing
    untracked PSet maxEvents = { untracked int32 input = 10 }

    include "FWCore/MessageService/data/MessageLogger.cfi"
    
    source = PoolSource {
    	untracked vstring fileNames = { 
            "file:/server/01a/ceballos/CMSSW_2_0_7_ntuples/Zmm/10375028-DD24-DD11-8170-001617E30F4C.root", 
            "file:/server/01a/ceballos/CMSSW_2_0_7_ntuples/Zmm/12CA1A34-DB24-DD11-AA5F-001D09F2426D.root", 
            "file:/server/01a/ceballos/CMSSW_2_0_7_ntuples/Zmm/D6B9828D-DE24-DD11-AE72-001D09F2432B.root" 
        }
    }
	
    # Geometry 
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
    include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi" 
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
    include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"
    # Propagator
    es_module MuonMaterialPropagator = PropagatorWithMaterialESProducer {
        string ComponentName        = "MuonMaterialPropagator"
        string PropagationDirection = "alongMomentum"
        double Mass                 = 0.105
        double MaxDPhi              = 1.6
        bool useRungeKutta          = false
    }	
    # Crap
    include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"
    include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"
    include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
    include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
    include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilderWithoutRefit.cfi"   
    # Fitters
    es_module MuonFitterRK = KFTrajectoryFitter from "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"
    replace MuonFitterRK.ComponentName = "MuonFitterRK"
    replace MuonFitterRK.Propagator    = "MuonMaterialPropagator"

    # Smoothers
    es_module MuonSmootherRK          = KFTrajectorySmoother from "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"
    replace MuonSmootherRK.ComponentName = "MuonSmootherRK"
    replace MuonSmootherRK.Propagator    = "MuonMaterialPropagator"

    # FittingSmoothers
    es_module MuonFittingSmootherRK = KFFittingSmoother from "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi"
    replace MuonFittingSmootherRK.ComponentName   = "MuonFittingSmootherRK"
    replace MuonFittingSmootherRK.Fitter          = "MuonFitterRK"
    replace MuonFittingSmootherRK.Smoother        = "MuonSmootherRK"

    module MuonTrackRefitter = TrackRefitter {
        string Fitter          = "MuonFittingSmootherRK"   
        string Propagator      = "MuonMaterialPropagator"
        
        InputTag src           = generalTracks
        InputTag beamSpot      = offlineBeamSpot
        string TTRHBuilder     = "WithoutRefit"
        bool TrajectoryInEvent = false
        string constraint      = ""
        bool useHitsSplitting  = false
        string AlgorithmName   = "undefAlgorithm"
    }
    
    sequence Refit = { MuonTrackRefitter }

    # define the object service
    service = ObjectService { }

    # define the tree service
    service = TreeService { 
        untracked vstring fileNames   = { "mit-zmm-example" }
    }

    # a simple muon maker
    module MuonsStable = Stable {
        untracked string iTracks   = "generalTracks"
        untracked int32  oPid      = 13
        untracked double oMass     = 0.105658
    }
    # a simple J/psi to Mu Mu finder
    module Jpsi2MuMu = D2SS {
        untracked string iStables1 = "MuonsStable"
        untracked string iStables2 = "MuonsStable"
        untracked int32  oPid      = 443
        untracked double oMass     = 3.09687
    }
    
    # include the MIT filler
    include "MitProd/TreeFiller/data/MitTreeFiller.cfi"

    # define an output file and drop everything that you don't want. 
    # Make sure to KEEP your producer output
    module OutputModule = PoolOutputModule { 
        untracked string fileName = "edm-zmm-example.root" 
	untracked vstring outputCommands = {
	    "keep *"
	}
    }

    # standard path of action of the module
    path p0 = { MuonsStable, Jpsi2MuMu, MitTreeFiller } 

    endpath end = { OutputModule }
    
    # schedule the various path
    schedule = { p0, end }
}
